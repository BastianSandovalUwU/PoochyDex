<aside [ngClass]="{
  'translate-x-0 opacity-100': isOpen,
  '-translate-x-full opacity-0': !isOpen
}"
      class="menu fixed top-0 left-0 w-64 h-screen rounded-tr-xl mt-[1px]
      bg-gray-50 border border-gray-300 dark:bg-gray-800 transition-all duration-300 z-40 flex flex-col shadow-xl">
  <!-- Header with logo and close button -->
  <div class="flex items-center justify-between p-4 border-b dark:border-gray-700">
    <a class="flex items-center">
      <img src="/assets/icons/icon-512x512.png" class="h-8 sm:h-10" alt="PoochyDex Logo"/>
      <span class="ml-2 text-2xl font-bold text-gray-800 dark:text-white">PoochyDex</span>
    </a>
    <button (click)="closeMenu()" class="rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
      <mat-icon class="text-gray-600 dark:text-gray-300">close</mat-icon>
    </button>
  </div>

  <!-- Main Navigation -->
  <div class="flex-1 px-3 py-4 overflow-y-auto">
    <ul class="space-y-1">
      <ng-container *ngFor="let option of filteredMenuOptions">
        <!-- Opción con hijos (menú expandible) -->
        <li *ngIf="option.children && option.children.length > 0">
          <div class="">
            <div (click)="toggleExpanded(option)"
                 class="flex items-center p-3 text-gray-700 dark:text-gray-200 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors cursor-pointer group">
              <img *ngIf="option.imageIcon" class="w-8 h-8 object-contain" [src]="option.imageIcon" [alt]="getLabel(option)">
              <mat-icon *ngIf="!option.imageIcon" class="text-gray-600 dark:text-gray-300 mr-2">{{ option.icon }}</mat-icon>
              <span class="ml-3 font-medium flex-1">{{ getLabel(option) }}</span>
              <mat-icon class="text-gray-400 group-hover:text-gray-600 dark:group-hover:text-gray-300 transition-transform duration-200"
                        [class.rotate-90]="isExpanded(option)">
                chevron_right
              </mat-icon>
            </div>
            <ul *ngIf="isExpanded(option)" class="mt-1 ml-4 space-y-1 animate-fade-in">
              <li *ngFor="let child of option.children">
                <a [href]="child.route"
                   [class.bg-red-100]="isRouteActive(child.route)"
                   [class.dark:bg-red-900]="isRouteActive(child.route)"
                   [class.border-red-500]="isRouteActive(child.route)"
                   [class.border-2]="isRouteActive(child.route)"
                   [class.text-red-700]="isRouteActive(child.route)"
                   [class.dark:text-red-300]="isRouteActive(child.route)"
                   class="flex items-center p-2 text-gray-700 dark:text-gray-200 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors group">
                  <img *ngIf="child.imageIcon" class="w-6 h-6 object-contain" [src]="child.imageIcon" [alt]="getLabel(child)">
                  <mat-icon *ngIf="!child.imageIcon" class="text-gray-600 dark:text-gray-300 mr-2" style="font-size: 20px; width: 20px; height: 20px;">{{ child.icon }}</mat-icon>
                  <span class="ml-2 font-medium text-sm">{{ getLabel(child) }}</span>
                  <mat-icon class="ml-auto text-gray-400 group-hover:text-gray-600 dark:group-hover:text-gray-300" style="font-size: 18px; width: 18px; height: 18px;">chevron_right</mat-icon>
                </a>
              </li>
            </ul>
          </div>
        </li>

        <!-- Opción simple sin hijos -->
        <li *ngIf="!option.children || option.children.length === 0">
          <a [href]="option.route"
             [class.bg-red-100]="isRouteActive(option.route)"
             [class.dark:bg-red-900]="isRouteActive(option.route)"
             [class.border-red-500]="isRouteActive(option.route)"
             [class.border-2]="isRouteActive(option.route)"
             [class.text-red-700]="isRouteActive(option.route)"
             [class.dark:text-red-300]="isRouteActive(option.route)"
             class="flex items-center p-3 text-gray-700 dark:text-gray-200 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors group">
            <img *ngIf="option.imageIcon" class="w-8 h-8 object-contain" [src]="option.imageIcon" [alt]="getLabel(option)">
            <mat-icon *ngIf="!option.imageIcon" class="text-gray-600 dark:text-gray-300 mr-2">{{ option.icon }}</mat-icon>
            <span class="ml-3 font-medium">{{ getLabel(option) }}</span>
            <mat-icon class="ml-auto text-gray-400 group-hover:text-gray-600 dark:group-hover:text-gray-300">chevron_right</mat-icon>
          </a>
        </li>
      </ng-container>
    </ul>
  </div>

  <!-- Footer with Settings -->
  <div class="p-4 border-t dark:border-gray-700">
    <!-- User Authentication Section -->
    <div class="mb-4 pb-4 border-b dark:border-gray-700">
      <div *ngIf="!userData" class="space-y-1.5">
        <a href="/auth/login"
           class="flex items-center justify-center px-3 py-2 text-sm text-white bg-blue-500 hover:bg-blue-600 rounded-md transition-colors group">
          <mat-icon class="mr-1.5" style="font-size: 18px; width: 18px; height: 18px;">login</mat-icon>
          <span class="font-medium">{{ language === 'es' ? 'Iniciar Sesión' : 'Login'}}</span>
        </a>
        <a href="/auth/sign-up"
           class="flex items-center justify-center px-3 py-2 text-sm text-blue-500 border border-blue-500 hover:bg-blue-50 dark:hover:bg-gray-700 rounded-md transition-colors">
          <mat-icon class="mr-1.5" style="font-size: 18px; width: 18px; height: 18px;">person_add</mat-icon>
          <span class="font-medium">{{ language === 'es' ? 'Registrarse' : 'Sign Up'}}</span>
        </a>
      </div>

      <div *ngIf="userData" class="space-y-1.5">
        <div class="flex items-center px-3 py-2 bg-gray-100 dark:bg-gray-700 rounded-md">
          <mat-icon class="text-gray-600 dark:text-gray-300 mr-1.5" style="font-size: 18px; width: 18px; height: 18px;">account_circle</mat-icon>
          <span class="text-sm text-gray-700 dark:text-gray-200 font-medium truncate">{{ userData.user }}</span>
        </div>
        <a href="/profile/show"
           class="flex items-center px-3 py-2 text-sm text-gray-700 dark:text-gray-200 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors group">
          <mat-icon class="mr-1.5" style="font-size: 18px; width: 18px; height: 18px;">person</mat-icon>
          <span class="font-medium">{{ language === 'es' ? 'Mi Perfil' : 'My Profile'}}</span>
          <mat-icon class="ml-auto text-gray-400 group-hover:text-gray-600 dark:group-hover:text-gray-300" style="font-size: 18px; width: 18px; height: 18px;">chevron_right</mat-icon>
        </a>
        <button (click)="logout()"
           class="w-full flex items-center justify-center px-3 py-2 text-sm text-white bg-red-500 hover:bg-red-600 rounded-md transition-colors">
          <mat-icon class="mr-1.5" style="font-size: 18px; width: 18px; height: 18px;">logout</mat-icon>
          <span class="font-medium">{{ language === 'es' ? 'Cerrar Sesión' : 'Logout'}}</span>
        </button>
      </div>
    </div>

    <div class="flex items-center justify-between mb-2">
      <span class="text-gray-600 dark:text-gray-400 text-sm font-medium">{{ language === 'es' ? 'Tema' : 'Theme' }}</span>
      <app-theme-toggle></app-theme-toggle>
    </div>

    <p class="text-gray-500 dark:text-gray-400 text-md">PoochyDex {{ versionNumber }}</p>
  </div>
</aside>

<!-- Overlay for mobile -->
<div *ngIf="isOpen"
     class="fixed inset-0 bg-black bg-opacity-50 z-30 sm:hidden transition-opacity duration-300"
     (click)="closeMenu()">
</div>
