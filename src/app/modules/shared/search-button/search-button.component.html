<!-- Floating Search Button -->
<div class="fixed bottom-10 right-[17px] w-16 h-16 z-[1000] transition-transform duration-300 ease-out hover:scale-110 active:scale-95">
  <button
    (click)="toggleSearch()"
    [attr.aria-label]="language === 'es' ? 'Abrir búsqueda' : 'Open search'"
    [attr.aria-expanded]="showSearch"
    class="w-full h-full bg-gradient-to-br from-blue-500 to-blue-600 dark:from-blue-400 dark:to-blue-500 border-2 border-white/20 dark:border-white/15 rounded-full flex justify-center items-center cursor-pointer shadow-lg hover:shadow-xl hover:-translate-y-0.5 hover:from-blue-600 hover:to-blue-700 dark:hover:from-blue-500 dark:hover:to-blue-600 transition-all duration-300 ease-out relative overflow-hidden focus-visible:outline-2 focus-visible:outline-blue-500 focus-visible:outline-offset-2 dark:focus-visible:outline-blue-400 active:scale-[0.98] search-button-ripple">
    <mat-icon class="text-white text-[28px] w-7 h-7 drop-shadow-[0_1px_2px_rgba(0,0,0,0.2)] relative z-10">search</mat-icon>
  </button>
</div>

<!-- Search Overlay -->
<div
  [ngClass]="{ 'opacity-100 visible': showSearch, 'opacity-0 invisible': !showSearch }"
  (click)="toggleSearch()"
  [attr.aria-hidden]="!showSearch"
  role="dialog"
  [attr.aria-modal]="showSearch"
  [attr.aria-labelledby]="showSearch ? 'search-title' : null"
  class="fixed inset-0 bg-black/60 backdrop-blur-sm flex justify-center items-center z-[1050] transition-opacity duration-300 ease-out">

  <!-- Search Container -->
  <div
    [ngClass]="{ 'translate-y-0 scale-100 opacity-100': showSearch, '-translate-y-5 scale-95 opacity-0': !showSearch }"
    (click)="$event.stopPropagation()"
    role="dialog"
    class="bg-white/95 dark:bg-gray-800/95 backdrop-blur-xl border border-black/10 dark:border-white/10 rounded-2xl shadow-2xl w-[90%] max-w-2xl max-h-[85vh] overflow-hidden flex flex-col transition-all duration-300 ease-out sm:w-[95%] sm:rounded-xl">

    <!-- Header -->
    <div class="flex justify-between items-center px-6 py-6 pb-5 border-b border-black/8 dark:border-white/10 sm:px-5 sm:py-5 sm:pb-4">
      <h1 id="search-title" class="text-2xl font-bold text-gray-900 dark:text-gray-50 tracking-tight m-0 sm:text-xl">
        {{ language === 'es' ? 'Búsqueda de Pokémon' : 'Search Pokémon' }}
      </h1>
      <button
        (click)="toggleSearch()"
        [attr.aria-label]="language === 'es' ? 'Cerrar búsqueda' : 'Close search'"
        class="w-9 h-9 flex items-center justify-center rounded-lg border-none bg-transparent text-gray-500 dark:text-gray-400 cursor-pointer transition-all duration-200 hover:bg-black/5 dark:hover:bg-white/10 hover:text-gray-900 dark:hover:text-gray-50 active:scale-95 focus-visible:outline-2 focus-visible:outline-blue-500 focus-visible:outline-offset-2 dark:focus-visible:outline-blue-400">
        <mat-icon class="text-xl w-5 h-5">close</mat-icon>
      </button>
    </div>

    <!-- Search Input Wrapper -->
    <div class="relative px-6 pb-5 flex items-center sm:px-5 sm:pb-4 mt-2">
      <mat-icon class="absolute left-9 text-gray-400 dark:text-gray-500 text-xl w-5 h-5 pointer-events-none z-10 sm:left-8">search</mat-icon>
      <input
        type="text"
        [(ngModel)]="searchQuery"
        (input)="filterData()"
        (keydown.escape)="toggleSearch()"
        [placeholder]="language === 'es' ? 'Buscar Pokémon por nombre...' : 'Search Pokémon by name...'"
        autocomplete="off"
        [attr.aria-label]="language === 'es' ? 'Campo de búsqueda' : 'Search field'"
        class="w-full pl-12 pr-10 py-3 text-base border-2 border-black/10 dark:border-white/15 rounded-xl bg-gray-50 dark:bg-gray-900/60 text-gray-900 dark:text-gray-50 transition-all duration-200 outline-none placeholder:text-gray-400 dark:placeholder:text-gray-500 focus:border-blue-500 dark:focus:border-blue-400 focus:bg-white dark:focus:bg-gray-900/80 focus:ring-4 focus:ring-blue-500/10 dark:focus:ring-blue-400/20"
      />
      <button
        *ngIf="searchQuery"
        (click)="searchQuery = ''; filterData()"
        [attr.aria-label]="language === 'es' ? 'Limpiar búsqueda' : 'Clear search'"
        class="absolute right-9 w-7 h-7 flex items-center justify-center rounded-md border-none bg-black/5 dark:bg-white/10 text-gray-500 dark:text-gray-400 cursor-pointer transition-all duration-200 hover:bg-black/10 dark:hover:bg-white/15 hover:text-gray-900 dark:hover:text-gray-50 focus-visible:outline-2 focus-visible:outline-blue-500 focus-visible:outline-offset-2 dark:focus-visible:outline-blue-400 sm:right-8">
        <mat-icon class="text-base w-4 h-4">close</mat-icon>
      </button>
    </div>

    <!-- Results -->
    <div class="flex-1 overflow-y-auto px-4 pb-4 min-h-[200px] max-h-[calc(85vh-220px)] sm:px-3 sm:pb-3 sm:max-h-[calc(90vh-200px)] search-results-scrollbar">
      <ul class="list-none p-0 m-0" *ngIf="limitedFilteredData.length > 0">
        <li
          (click)="navigateToPokemon(item.name)"
          (keydown.enter)="navigateToPokemon(item.name)"
          *ngFor="let item of limitedFilteredData; trackBy: trackByPokemonName"
          tabindex="0"
          role="button"
          class="flex items-center px-4 py-3 mb-2 rounded-xl cursor-pointer bg-transparent border border-transparent transition-all duration-200 outline-none hover:bg-blue-500/10 dark:hover:bg-blue-400/15 hover:border-blue-500/20 dark:hover:border-blue-400/25 hover:translate-x-1 active:translate-x-0.5 active:scale-[0.98] focus-visible:outline-2 focus-visible:outline-blue-500 focus-visible:outline-offset-2 dark:focus-visible:outline-blue-400 sm:px-3 sm:py-2.5">
          <img
            [src]="item.sprites.iconUrl"
            [alt]="(item.name | replaceDash | titlecase) + ' sprite'"
            loading="lazy"
            class="w-14 h-14 object-contain mr-4 drop-shadow-[0_2px_4px_rgba(0,0,0,0.1)] sm:w-12 sm:h-12 sm:mr-3"
          />
          <span class="text-base font-medium text-gray-900 dark:text-gray-50 tracking-tight">{{ item.name | replaceDash | titlecase }}</span>
        </li>
      </ul>

      <!-- Empty State -->
      <div
        *ngIf="limitedFilteredData.length === 0 && searchQuery !== ''"
        class="flex flex-col items-center justify-center py-12 px-6 text-center">
        <mat-icon class="text-[64px] w-16 h-16 text-gray-400 dark:text-gray-500 mb-4 opacity-60">search_off</mat-icon>
        <p class="text-lg font-semibold text-gray-700 dark:text-gray-300 m-0 mb-2">
          {{ language === 'es' ? 'No se encontró ningún Pokémon' : 'No Pokémon found' }}
        </p>
        <p class="text-sm text-gray-500 dark:text-gray-400 m-0">
          {{ language === 'es' ? 'Intenta buscar con otro nombre' : 'Try searching with a different name' }}
        </p>
      </div>

      <!-- Initial State -->
      <div
        *ngIf="limitedFilteredData.length === 0 && searchQuery === ''"
        class="flex flex-col items-center justify-center py-12 px-6 text-center">
        <p class="text-lg font-semibold text-gray-700 dark:text-gray-300 m-0 mb-2">
          {{ language === 'es' ? 'Busca cualquier Pokémon' : 'Search for any Pokémon' }}
        </p>
        <p class="text-sm text-gray-500 dark:text-gray-400 m-0">
          {{ language === 'es' ? 'Escribe el nombre para comenzar' : 'Type a name to get started' }}
        </p>
      </div>
    </div>
  </div>
</div>
